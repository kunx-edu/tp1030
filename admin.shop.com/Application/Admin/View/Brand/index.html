<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>ECSHOP 管理中心 - {$meta_title} </title>
        <meta name="robots" content="noindex, nofollow"/>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="__CSS__/general.css" rel="stylesheet" type="text/css" />
        <link href="__CSS__/main.css" rel="stylesheet" type="text/css" />
        <css href="__CSS__/page.css" />
    </head>
    <body>
        <h1>
            <span class="action-span"><a href="{:U('patchAdd')}">批量添加品牌</a></span>
            <span class="action-span"><a href="{:U('add')}">添加品牌</a></span>
            <span class="action-span1"><a href="{:U('Index/main')}">ECSHOP 管理中心</a></span>
            <span id="search_id" class="action-span1"> - {$meta_title} </span>
        </h1>
        <div style="clear:both"></div>
        <div class="form-div">
            <form action="{:U('',array('p'=>1))}" name="searchForm">
                <img src="__IMG__/icon_search.gif" width="26" height="22" border="0" alt="search" />
                <input type="text" name="keyword" size="15" value='{$keyword}'/>
                <input type="submit" value=" 搜索 " class="button" />
            </form>
        </div>
        <form method="post" action="" name="listForm">
            <div class="list-div" id="listDiv">
                <table cellpadding="3" cellspacing="1">
                    <tr>
                        <th>品牌名称</th>
                        <th>品牌描述</th>
                        <th>排序</th>
                        <th>是否显示</th>
                        <th>操作</th>
                    </tr>
                    <foreach name="rows" item="row">
                    <tr>
                        <td align="center">
                            {$row.name}
                        </td>
                        <td align="center">{$row.intro}</td>
                        <td align="center">{$row.sort}</td>
                        <!--<td align="center"><img src="__IMG__/{/*$row.enable*/}" /></td>-->
                        <td align="center"><img style="cursor: pointer;" src="__IMG__/{$row.status}.gif" class="status" href="{:U('changeStatus',array('id'=>$row['id']))}" data="{$row.status}"/></td>
                        <td align="center">
                            <a href="{:U('edit',array('id'=>$row['id']))}" title="编辑">编辑</a> |
                            <a href="{:U('changeStatus',array('id'=>$row['id']))}" title="移除">移除</a> 
                        </td>
                    </tr>
                    </foreach>
                    <tr>
                        <td align="right" nowrap="true" colspan="6">
                            <div id="turn-page" class="page">
                                {$page_html}
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </form>

        <div id="footer">
            版权所有 &copy; 2005-2012 上海商派网络科技有限公司，并保留所有权利。
        </div>
        <js href='__JS__/jquery.min.js'/>
        <js href='__EXT__/layer/layer.js'/>
        <script type='text/javascript'>
            $(function(){
                //给状态图片添加点击事件
                $('.status').click(function(){
                    var url = $(this).attr('href');
                    //保存节点
                    var ele = $(this);
                    console.debug(url);
                    var new_status = 1-ele.attr('data');
                    //发送ajax请求到指定的页面，然后根据返回结果，操作具体的dom对象
                    $.get(url,{status:new_status},function(data){
                        console.debug(data);
                        //判断是否成功，如果成功data中的status值就是1
                        if(data.status == 1){
//                            ele.attr('src','__IMG__/'+data.status+'.gif');
//                            ele.attr('src',function(i,v){
//                                console.debug(i,v);
//                            });
//                            ele.attr('data',1 - ele.attr('data'));
//                            ele.attr('src','__IMG__/'+ele.attr('data')+'.gif');
                            //将data属性的值设置为新的状态
                            //并且切换提示图标
                            ele.attr('data',new_status);
                            ele.attr('src','__IMG__/'+new_status+'.gif');
                            layer.msg(data.info,{
                                time:1000,
                                icon:1,
                            });
                        }else{
                            layer.msg(data.info,{
                                time:1000,
                                icon:2,
                            });
                        }
                    });
                });
            });
        </script>
    </body>
</html>